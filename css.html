<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>Uglify JS - use it with caution and node</title>
	<link rel="stylesheet" href="css/bootstrap.min.css" media="all">
</head>
<body>
<div class="topbar">
	<div class="fill">
		<div class="container">
			<a class="brand" href="#">uglify assets</a>

			<ul class="nav">
				<li><a href="/">javascript</a></li>
				<li class="active"><a href="/css">CSS</a></li>				
			</ul>
		</div>
	</div>
</div>

<div class="container">
	<div class="content">
		<div class="page-header">
			<h3>minimize assets with node</h3>
        </div>
    	<div class="row">
			<div class="span12">
				<h4>Use an url, textarea or a file drag&amp;drop</h4>
			</div>
			<div class="span14">
				<ul class="tabs" data-tabs="tabs" >
				    <li class="active">
						<a href="#add-url">URL</a>
					</li>
					<li>
						<a href="#add-text">Textarea</a>
					</li>
					<li>
						<a href="#add-drag">Drag&amp;Drop</a>
					</li>
				</ul>

				<div class="tab-content">
					<div class="active" id="add-url">
						<h5>Add URL to the js to be uglified</h5>
						<p>It should contain the http(s): part too.</p>
						<form action="/css" method="post">
							<div class="clearfix">
								<label for="url">URL</label>
								<div class="input">
									<input class="xxlarge" id="url" name="url" size="30" type="text" placeholder="ex: http://example.com/what.js">
								</div>								
							</div>
							<div class="clearfix">
								<div class="input">
									<button type="submit" class="btn primary">Parse and uglify</button>
								</div>
							</div>
						</form>
						<div class="clearfix hidden" id="ugly-one">
							<h5>Result - beware it's ugly</h5>
							<textarea name="result" id="result" class="span11" rows="20"></textarea>
						</div>
					</div>

					<div id="add-text">
						<h5>Add some javascript text</h5>
						<form action="/css" method="post">
							<label for="code">Some js code</label>	
							<div class="clearfix">
								<div class="input">
									<textarea class="span11" id="code" name="code" rows="10"></textarea>
								</div>
							</div>
							<div class="clearfix">
								<div class="input">
									<button type="submit" class="btn primary">Parse and uglify</button>
								</div>
							</div>
						</form>
						<div class="clearfix hidden" id="ugly-two">
							<h5>Result - beware it's ugly</h5>
							<textarea name="result" id="result-two" class="span11" rows="20"></textarea>
						</div>
					</div>

					<div id="add-drag">
						<h5>Drag &amp; Drop js files</h5>
						<div id="drop_zone">
							Drop files here
						</div>
						<div class="clearfix hidden" id="ugly-three">
							<h5>Result - beware it's ugly</h5>
							<textarea name="result" id="result-three" class="span11" rows="20"></textarea>
						</div>
					</div>
				</div>
			</div>
    	</div>
	</div>
	<footer>
		<p>&copy; dplesca</p>
	</footer>
</div> <!-- /container -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap-tabs.js"></script>
<script src="js/jquery.form.js"></script>
<script>
	$(function(){
		$('input#url').focus(function(){
			$(this).css('color', '#333');
		});
		$('input#url').blur(function(){
			if ($(this).val() === '')
				$(this).css('color', '#BFBFBF');
		});
		$('form').ajaxForm({
			success:function(data){
				if ( $('#add-url').is(':visible') ){
					$('#result').val(data);
					$('#ugly-one').slideDown(1500);	
				}
				else if ( $('#add-text').is(':visible') ){
					$('#result-two').val(data);
					$('#ugly-two').slideDown(1500);
				}
			}
		});
		$('textarea#result, textarea#result-two, textarea#result-three').focus(function(){
			$(this).select();
		});
	});

	// Setup the dnd listeners.
	var dropZone = document.getElementById('drop_zone');
	dropZone.addEventListener('dragover', handleDragOver, false);
	dropZone.addEventListener('drop', handleFileSelect, false);

	function handleDragOver(evt) {
		evt.stopPropagation();
		evt.preventDefault();
	}

	function handleFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        var files = evt.dataTransfer.files; // FileList object.
        // files is a FileList of File objects. List some properties.
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function(theFile) {
                return function(e) {
                	$.post('/css', {file_content: e.target.result}, function(data){
                		$('#result-three').val( $('#result-three').val() + data );
                		if ( !$('#ugly-three').is(':visible') )
                			$('#ugly-three').slideDown(1500);
                	});
                    //console.log(e.target.result);
                };
           })(f);
            // Read in the image file as a data URL.
            reader.readAsBinaryString(f);
        }
    }
</script>
</body>
</html>